# Arch7z Installer Final Settings Configuration
# Commands executed after kernel copy and initramfs generation
# These commands are applied to the installed system in /mnt

[variables]
bootloader_id=Xray_OS

[metadata]
version=1.0
description=Final system configuration commands

[system_commands]
# Basic system setup (FIRST - foundation)
enabled=true
timeout=120
commands=
    pacman-key --init,
    pacman-key --populate archlinux,
    pacman-key --populate chaotic,
    locale-gen,
    hwclock --systohc

[vm_bootloader_commands]
# VM-specific GRUB installation (BIOS/Legacy mode)
enabled=true
condition=vm_detected
timeout=120
commands=
    grub-install --target=i386-pc /dev/sda

[external_scripts]
# Hardware-specific scripts (AFTER bootloader and initramfs generation)
enabled=true
timeout=300
commands=
    arch7z-all-cores,
    arch7z-displaymanager-check,
    gpu-cleanup,
    arch7z-nvidia-settings,
    arch7z-system-final

[cleanup_commands]
# Final cleanup (LAST) - moved from remove-after-install script
enabled=true
timeout=60
allow_failures=true
commands=
    pacman -R --noconfirm arch7z-installer,
    pacman -R --noconfirm arch7z-installation-config,
    rm -f /etc/sudoers.d/g_wheel,
#    rm -f /etc/polkit-1/rules.d/49-nopasswd_global.rules,
    rm -f /etc/pacman.d/hooks/uncomment-mirrors.hook,
    rm -f /etc/pacman.d/hooks/zzzz99-remove-custom-hooks-from-airootfs.hook,
    rm -f /root/.automated_script.sh,
    rm -f /root/.zlogin,
    rm -f /etc/pacman.conf.arch7z,
    userdel -r liveuser

[network_commands]
# Commands requiring internet connection
enabled=true
requires_internet=true
timeout=60
commands=systemctl enable NetworkManager.service
